generator client {
  provider      = "prisma-client-js"
  output        = "./generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Book {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title     String    @db.VarChar(255)
  author    String    @db.VarChar(255)
  coverurl  String?   @db.VarChar(255)
  createdat DateTime? @default(now()) @db.Timestamp(6)
  Order     Order[]
}

model Location {
  id   String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name String   @db.VarChar(255)
  type String?  @db.VarChar(50)
  lat  Decimal? @db.Decimal(10, 7)
  lon  Decimal? @db.Decimal(10, 7)
}

model Notification {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userid    String?   @db.Uuid
  title     String    @db.VarChar(255)
  body      String
  readat    DateTime? @db.Timestamp(6)
  createdat DateTime? @default(now()) @db.Timestamp(6)
  User      User?     @relation(fields: [userid], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Order {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userid     String?   @db.Uuid
  bookid     String?   @db.Uuid
  status     String    @db.VarChar(50)
  totalprice Decimal   @db.Decimal(10, 2)
  createdat  DateTime? @default(now()) @db.Timestamp(6)
  Book       Book?     @relation(fields: [bookid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User       User?     @relation(fields: [userid], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Payment    Payment[]
}

model Payment {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderid         String?   @db.Uuid
  stripepaymentid String?   @db.VarChar(255)
  status          String    @db.VarChar(50)
  createdat       DateTime? @default(now()) @db.Timestamp(6)
  Order           Order?    @relation(fields: [orderid], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model User {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String         @unique @db.VarChar(255)
  passwordhash String?        @db.VarChar(255)
  name         String?        @db.VarChar(255)
  country      String         @default("EN") @db.VarChar(255)
  isPremium    Boolean        @default(false)
  isKroniq     Boolean        @default(false)
  createdAt    DateTime       @default(now()) @db.Timestamp(6)
  provider     String?        @db.VarChar(50)
  providerId   String?        @db.VarChar(255)
  GroupMembers GroupMembers[]
  Groups       Groups[]
  Notification Notification[]
  Order        Order[]
  TripShares   TripShares[]
  Trips        Trips[]
}

model GroupMembers {
  userId  String @db.Uuid
  groupId String @db.Uuid
  role    String @db.VarChar
  Groups  Groups @relation(fields: [groupId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User    User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([userId, groupId])
}

model Groups {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  adminId      String         @db.Uuid
  createdAt    DateTime?      @default(now()) @db.Timestamp(6)
  GroupMembers GroupMembers[]
  User         User           @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model Themes {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String    @db.VarChar
  description String?
  createdAt   DateTime? @default(now()) @db.Timestamp(6)
}

model TripShares {
  tripId    String    @db.Uuid
  visitorId String    @db.Uuid
  expiresAt DateTime? @db.Timestamp(6)
  Trips     Trips     @relation(fields: [tripId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  User      User      @relation(fields: [visitorId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([tripId, visitorId])
}

model Trips {
  id      String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  coverImageUrl String?
  mapImageUrl   String? @db.VarChar(512)
  mapImageFullUrl String?
  ownerId String @db.Uuid

  // Core
  name        String @db.VarChar
  destination String @db.VarChar // EUROPE | ASIA | ...
  transport   String @db.VarChar // CAR | PLANE | ...

  // Route
  from      String   @db.VarChar
  to        String   @db.VarChar
  waypoints String[] @default([]) // max 3 – hlídá DTO

  // Dates
  startDate DateTime @db.Date
  endDate   DateTime @db.Date

  // Optional
  theme String? @db.VarChar // SUMMER | WINTER | ...

  // Meta
  createdAt DateTime @default(now()) @db.Timestamp(6)

  // Relations
  TripShares TripShares[]
  User       User         @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model TripMapCache {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cacheKey String @unique @db.VarChar(64)

  imageUrl String @db.VarChar(512)

  // pro debug / dohledání
  fromText  String? @db.VarChar(255)
  toText    String? @db.VarChar(255)
  transport String? @db.VarChar(50)

  createdAt DateTime @default(now()) @db.Timestamp(6)
  updatedAt DateTime @updatedAt @db.Timestamp(6)
}
